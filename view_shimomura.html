<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ãƒ¼ãƒ‰</title>
<style>
body {
  font-family: 'Noto Serif JP', serif;
  background: linear-gradient(135deg,#fff1f5,#ffffff,#fce4ec);
  margin:0; padding:20px; color:#333; position:relative;
  overflow-x:hidden;
  transition: filter 0.4s ease;
}

/* ã‚¿ã‚¤ãƒˆãƒ« */
h2, h3 {
  text-align:center;
  position:relative;
  z-index:10;
  transition: filter 0.4s ease;
}
h2{margin:30px 0 10px;font-size:clamp(20px,4vw,28px);color:#d81b60;}
h3{font-size:clamp(14px,2.5vw,16px);color:#555;margin-bottom:20px;opacity:0.75;}

/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆ */
#list{
  display:flex;
  flex-direction:column;
  gap:20px;
  max-width:90%;
  width:400px;
  margin:20px auto;
  position:relative;
  z-index:10;
  transition: filter 0.4s ease;
  text-align:center;
}

/* ã‚«ãƒ¼ãƒ‰ */
.card{
  position: relative; 
  border-radius:20px;
  padding:25px 30px;
  box-shadow:0 8px 24px rgba(0,0,0,0.15);
  cursor:pointer;
  text-align:center;
  opacity:0;
  transform: translateY(20px) rotate(-5deg) scale(1);
  transition: transform 0.5s ease, box-shadow 0.5s ease, opacity 0.8s ease;
  background: #fff9f4;
  border: 2px solid #ffd1dc;
  z-index:10;
}

/* åå‰ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
.name{
  font-weight:bold;
  font-size:clamp(12px,2vw,16px);
  margin-top:12px;
  text-align:right;
}
.message{
  font-size:clamp(14px,2.5vw,16px);
  line-height:1.9;
  white-space:pre-wrap;
  padding:16px 20px;
  border-radius:12px;
  background-image:repeating-linear-gradient(
    to bottom,
    transparent,
    transparent 1.8em,
    rgba(200,200,200,0.15) 1.8em
  );
  margin-bottom:8px;
}

/* ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ãƒ»å›è»¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.card.visible{
  opacity:1;
  transform:translateY(0) rotate(0deg) scale(1);
}

/* èƒŒæ™¯æ¡œãƒ»ãƒãƒ¼ãƒˆ */
.particle-bg{
  position:fixed;
  pointer-events:none;
  font-size:16px;
  opacity:0.8;
  top:0; left:0;
  z-index:1; 
  animation-name: fallWavy;
  animation-timing-function:linear;
  animation-iteration-count:infinite;
}
@keyframes fallWavy{
  0% {transform:translateY(-30px) translateX(0) rotate(0deg);}
  50% {transform:translateY(50vh) translateX(15px) rotate(180deg);}
  100% {transform:translateY(110vh) translateX(0) rotate(360deg);}
}

/* ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */
#passwordForm{
  display:flex;
  flex-direction:column;
  align-items:center;
  margin:40px auto;
  gap:10px;
}
#passwordForm input{
  padding:10px 12px;
  font-size:16px;
  border-radius:8px;
  border:1px solid #ccc;
  width:200px;
  text-align:center;
}
#passwordForm button{
  padding:10px 20px;
  font-size:16px;
  border-radius:8px;
  border:none;
  background:#d81b60;
  color:#fff;
  cursor:pointer;
}

/* æ‹¡å¤§ã‚«ãƒ¼ãƒ‰ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆæš—è»¢ï¼‰ */
#overlay{
  position:fixed;
  top:0; left:0;
  width:100vw; height:100vh;
  background: rgba(0,0,0,0.5);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9999;
  overflow:auto;
}
#overlay .card{
  position:relative;
  transform: scale(0.8) rotate(0deg);
  width:90vw;
  max-width:95%;
  height:auto;
  padding:40px;
  border-radius:20px;
  box-shadow:0 20px 60px rgba(0,0,0,0.3);
  cursor:auto;
  transition: transform 0.5s cubic-bezier(0.4,0,0.2,1);
}
#overlay .card .message { font-size: clamp(16px, 3vw, 20px); }
#overlay .card .name { font-size: clamp(14px, 2.5vw, 18px); }
#overlay.show .card{ transform: scale(1); }
#overlay .close-btn{ position:absolute; top:10px; right:15px; font-size:22px; color:#888; cursor:pointer; font-weight:bold; }

.footer{text-align:center;font-size:12px;color:#888;margin:40px 0 10px;}

@media(max-width:480px){
  body{padding:16px;}
  h2{font-size:clamp(18px,5vw,22px);}
  h3{font-size:clamp(12px,3vw,16px);}
  .card{padding:18px 20px;}
  .message{padding:12px 14px;}
  .name{font-size:clamp(11px,3vw,14px);}
  #overlay .card{padding:30px; width:95vw;}
}
</style>
</head>
<body>

<h2 id="title">ä¸‹æ‘å…ˆç”Ÿã¸<br>1å¹´é–“ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ</h2>
<h3>ã‚«ãƒ¼ãƒ‰ã‚’ã‚¿ãƒƒãƒ—orã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æ‹¡å¤§ã—ã¾ã™</h3>

<div id="passwordForm">
  <input type="password" id="passwordInput" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
  <button id="passwordSubmit">é€ä¿¡</button>
  <div id="passwordError" style="color:red; margin-top:10px;"></div>
</div>

<div id="list" style="display:none;"></div>
<div class="footer">ï¼“å¹´ï¼˜çµ„ </div>
<div id="overlay"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyLIH03WHUMpHBipcqfaRhArtyrsGFpiuo9wUsfARcg4JHKGOP6MOnzkPfhRfZglnPsrw/exec";
const teacherName = "ä¸‹æ‘å…ˆç”Ÿ";

const observer = new IntersectionObserver(entries=>{
  entries.forEach(entry=>{
    if(entry.isIntersecting){
      const card=entry.target;
      setTimeout(()=>{card.classList.add('visible');}, parseFloat(card.dataset.delay)*1000 || 0);
      observer.unobserve(card);
    }
  });
},{threshold:0.2});

// èƒŒæ™¯æ¡œãƒ»ãƒãƒ¼ãƒˆ
function createBackgroundParticle() {
  const types = ["ğŸ’–","ğŸŒ¸","ğŸŒº","ğŸ’Œ","ğŸ€"];
  const p = document.createElement("div");
  p.className = "particle-bg";
  p.innerText = types[Math.floor(Math.random()*types.length)];
  const ww = window.innerWidth;
  const wh = window.innerHeight;
  const cards = document.querySelectorAll(".card");
  let left, top, tries = 0;
  do {
    left = Math.random()*ww;
    top = Math.random()*wh;
    let overlap=false;
    cards.forEach(c=>{
      const rect=c.getBoundingClientRect();
      if(left>=rect.left && left<=rect.right && top>=rect.top && top<=rect.bottom) overlap=true;
    });
    if(!overlap) break;
    tries++;
  } while(tries<10);
  p.style.left=left+"px";
  p.style.top=top+"px";
  p.style.fontSize=(14+Math.random()*16)+"px";
  p.style.opacity=0.4+Math.random()*0.6;
  p.style.animationDuration=(6+Math.random()*6)+"s";
  p.style.transform=`rotate(${Math.random()*360}deg)`;
  document.body.appendChild(p);
  setTimeout(()=>document.body.removeChild(p),12000);
}
setInterval(()=>{for(let i=0;i<2;i++) createBackgroundParticle();},300);

// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰é€ä¿¡å‡¦ç†
const passwordInput = document.getElementById("passwordInput");
const passwordSubmit = document.getElementById("passwordSubmit");
const errorDiv = document.getElementById("passwordError");

function submitPassword() {
  const password = passwordInput.value.trim();
  if(!password) return;

  // ã€ŒãŠå¾…ã¡ãã ã•ã„â€¦ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
  let dots = 0;
  errorDiv.style.color = "black";
  errorDiv.textContent = "ãŠå¾…ã¡ãã ã•ã„";
  const intervalId = setInterval(()=>{
    dots = (dots + 1) % 4; // 0ï½3
    errorDiv.textContent = "ãŠå¾…ã¡ãã ã•ã„" + "â€¦".repeat(dots);
  }, 500);

  fetch(`${API_URL}?teacher=${encodeURIComponent(teacherName)}&password=${encodeURIComponent(password)}`)
    .then(res=>res.json())
    .then(res=>{
      clearInterval(intervalId);
      if(res.status !== "ok"){
        errorDiv.style.color = "red";
        errorDiv.textContent = "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“";
        return;
      }
      document.getElementById("passwordForm").style.display="none";
      document.getElementById("list").style.display="flex";
      loadMessages(res.data);
    })
    .catch(err=>{
      clearInterval(intervalId);
      console.error(err);
      errorDiv.style.color = "red";
      errorDiv.textContent = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ã§ã™";
    });
}

// é€ä¿¡ãƒœã‚¿ãƒ³
passwordSubmit.addEventListener("click", submitPassword);

// Enterã‚­ãƒ¼ã§é€ä¿¡ï¼ˆpreventDefaultã§ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰é˜²æ­¢ï¼‰
passwordInput.addEventListener("keydown", e=>{
  if(e.key === "Enter"){
    e.preventDefault();
    submitPassword();
  }
});

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
function loadMessages(data){
  const list = document.getElementById("list");
  list.innerHTML="";
  if(!data || data.length===0){ list.textContent="ã¾ã ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“"; return; }

  data.sort((a,b)=>Number(a[1])-Number(b[1]));
  data.forEach((d,i)=>{
    const [teacher, no, name, message,, bgColor, borderColor, borderWidth, borderStyle, textColor] = d;

    const card = document.createElement("div");
    card.className = "card";
    card.style.background = bgColor || "#fff9f4";
    card.style.border = `${borderWidth||2}px ${borderStyle||"solid"} ${borderColor||"#ffd1dc"}`;
    const randomAngle=(Math.random()*20-10).toFixed(2);
    const randomY=(Math.random()*30+10).toFixed(2);
    card.style.transform=`translateY(${randomY}px) rotate(${randomAngle}deg)`;
    card.dataset.delay=(i*0.4).toFixed(2);
    card.innerHTML=`
      <div class="message" style="color:${textColor||"#333"}">${message.replace(/\n/g,"<br>")}</div>
      <div class="name" style="color:${textColor||"#333"}">${name}</div>
    `;
    list.appendChild(card);
    card.getBoundingClientRect();

    card.addEventListener("click",()=>{
      const overlay=document.getElementById("overlay");
      overlay.innerHTML="";
      const cloned = card.cloneNode(true);
      cloned.style.transform = "scale(0.8) rotate(0deg)";
      cloned.style.transition="transform 0.5s cubic-bezier(0.4,0,0.2,1)";
      const closeBtn = document.createElement("div");
      closeBtn.className="close-btn"; closeBtn.innerHTML="&times;";
      closeBtn.addEventListener("click",e=>{
        e.stopPropagation();
        overlay.style.display="none";
        list.style.filter="none";
        document.querySelector("h2").style.filter="none";
        document.querySelector("h3").style.filter="none";
        overlay.classList.remove("show");
      });
      cloned.appendChild(closeBtn);
      overlay.appendChild(cloned);
      overlay.style.display="flex";
      list.style.filter="blur(6px)";
      document.querySelector("h2").style.filter="blur(6px)";
      document.querySelector("h3").style.filter="blur(6px)";
      setTimeout(()=>overlay.classList.add("show"),50);
    });

    observer.observe(card);
  });
}

// ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
document.getElementById("overlay").addEventListener("click",e=>{
  if(e.target.id==="overlay"){
    e.target.style.display="none";
    document.getElementById("list").style.filter="none";
    document.querySelector("h2").style.filter="none";
    document.querySelector("h3").style.filter="none";
    e.target.classList.remove("show");
  }
});
</script>



</body>
</html>



